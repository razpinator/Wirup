var wirup=(function(){"use strict";const p=e=>document.getElementById(e),B=e=>{try{return JSON.parse(window[e])}catch{return window[e]}},A=e=>new Promise((t,r)=>{let n=document.createElement("script");n.type="text/javascript",n.src=e,document.getElementsByTagName("head")[0].appendChild(n),n.onload=()=>{t()},n.onerror=()=>{r(`Failed to load script: ${e}`)}}),F=(e,t)=>new Promise((r,n)=>{const o=t.map(s=>A(`${e}/${s}`));Promise.all(o).then(r).catch(s=>{console.error(`Error loading scripts from folder: ${s}`),n(s)})}).catch(r=>{console.error(`Error in loadScriptsFromFolder: ${r}`)}),O=e=>typeof e!="string"?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),f=e=>{if(typeof e=="string")return O(e);if(Array.isArray(e))return e.map(t=>f(t));if(typeof e=="object"&&e!==null){const t={};return Object.keys(e).forEach(r=>{t[r]=f(e[r])}),t}return e},E=async(e,t,r,n)=>{try{const o=await fetch(t,{method:e,headers:{"Content-Type":r,Pragma:"no-cache","Cache-Control":"no-cache"},cache:"no-store"});if(!o.ok)throw o.statusText||"Your ajax request threw an error.";const s=await o.text();return n?n(s):s}catch(o){throw o}};let P="";const v="wuActions",H=e=>{P=e},g=(e,t,r)=>{const o=new Date().getTime(),s={name:e,element:t,comment:r,profile:P,timestamp:o},a=localStorage.getItem(v)||"",l=a?",":"";localStorage.setItem(v,a+l+JSON.stringify(s))},c={};let d=e=>{console.warn("updateComponentsCallback not registered",e)};const R=e=>{d=e},U=(e,t)=>{let r=t;typeof t=="object"&&t!==null&&(r=new Proxy(t,{set:(n,o,s)=>(n[o]=s,d(e),!0),deleteProperty:(n,o)=>(delete n[o],d(e),!0)})),Object.defineProperty(c,e,{get:function(){return r},set:function(n){typeof n=="object"&&n!==null?r=new Proxy(n,{set:(o,s,a)=>(o[s]=a,d(e),!0),deleteProperty:(o,s)=>(delete o[s],d(e),!0)}):r=n,d(e)},configurable:!0})},q=(e,t)=>{Array.isArray(c[e])||c[e],c[e].push(t)},M=(e,t,r)=>{if(!c[e])throw new Error(`Data source '${e}' not found in dataStore`);return c[e].findIndex(o=>o[t]===r)},_=(e,t,r)=>{const n=c[e];let o=t-1<0?0:t-1;n[o]=r},z=(e,t)=>{const r=c[e];let n=t-1<0?0:t-1;r.splice(n,1)},i={},I=(e,t)=>{i[e]=t},h=(e,t)=>{let r=[];const n=c[t];if(!i[e])return console.warn(`Component ${e} not found`),"";const o=typeof n;if(n==null)return"";const s=f(n);switch(o){case"object":Array.isArray(s)?r=s.map(a=>i[e](a)):r.push(i[e](s));break;case"string":r.push(i[e](s));break;default:throw new Error(`Unsupported data type: ${o}`)}return Array.isArray(r)?r.join(""):r},J=(e,t)=>{let r=[];return e.forEach((n,o)=>{const s=c[t[o]];if(!i[n])return;const a=typeof s,l=f(s);switch(a){case"object":Array.isArray(l)?r=r.concat(l.map(b=>i[n](b))):r.push(i[n](l));break;case"string":r.push(i[n](l));break;default:throw new Error(`Unsupported data type: ${a}`)}}),Array.isArray(r)?r.join(""):r};let m=window.location.pathname,u=[],w={},x=()=>Promise.resolve(),S=()=>{};const K=e=>{x=e},V=e=>{S=e},Y=()=>w,G=e=>{u=JSON.parse(e).views},W=()=>E("GET","views/views.json","application/json; charset=UTF-8",G),Q=(e,t)=>{const r="views/"+u[e].viewFile;return new Promise((n,o)=>{fetch(r+"?").then(s=>{if(s.ok)return s.text();o(`Failed to load HTML view: ${r}`)}).then(s=>{const a=p(t);a?(a.innerHTML=s,n()):o(`Target element with ID "${t}" not found`)}).catch(o)})},k=e=>new Promise((t,r)=>{let n;const o=m||"/";if(!u||u.length===0){r("Views are undefined or empty, cannot load template.");return}for(let s=0;s<u.length;s++){if(u[s].url===o){n=s,w={};break}const a=u[s].url;if(a.includes(":")){const l=a.replace(/:([^\s/]+)/g,"([^\\s/]+)"),b=new RegExp("^"+l+"$"),L=o.match(b);if(L){n=s,w={},(a.match(/:([^\s/]+)/g)||[]).map(C=>C.slice(1)).forEach((C,oe)=>{w[C]=L[oe+1]});break}}}n===void 0&&(console.warn(`No view found for the URL: ${o}. Redirecting to default view.`),n=0),Q(n,e).then(()=>t()).catch(s=>{console.error(`Error filling view for URL ${o}: ${s}`),r(`Failed to fill view for ${o}`)})}).catch(t=>{console.error(`Error in getTemplate: ${t}`)}),X=e=>{history.pushState(null,null,e),m=e,k("contentBody").then(()=>{x()})},Z=()=>{window.onpopstate=e=>{m=window.location.pathname,S()}},D=()=>new Promise((e,t)=>{const r=p("contentBody");if(!r){e();return}const n=r.querySelectorAll("[datasource]");[].forEach.call(n,o=>{o.innerHTML=h(o.tagName.toLowerCase(),o.getAttribute("datasource"))}),g("Switched View","CBody","NA"),e()}),N=e=>{const t=p("contentBody");t&&t.querySelectorAll('[datasource="'+e+'"]').forEach(r=>{r.innerHTML=h(r.tagName.toLowerCase(),e),g("Updated Data.",r.tagName.toLowerCase(),"No Comment.")})};K(D),R(N);const T={},ee=e=>{Object.defineProperty(T,"trigger",{get:function(){return this._trigger},set:function(t){this._trigger=t,typeof window[t]=="function"&&window[t]()}}),T.trigger=e},te=e=>{if(typeof window[e]=="function")return window[e]()},re=e=>new Promise((t,r)=>{let n=["components.js"];e?.components&&Array.isArray(e.components)&&e.components.length>0&&(n=e.components),F("components",n).then(()=>{W().then(()=>{k("contentBody").then(()=>{D().then(()=>{Z(),typeof e.callbackName<"u"&&te(e.callbackName),t()})})})})}),j=e=>{re(e)};V(()=>j());const y={},ne=(e,t)=>{y[e]=t};typeof document<"u"&&document.addEventListener("click",e=>{let t=e.target;for(;t&&t!==document;){if(t.hasAttribute&&t.hasAttribute("wu-click")){const r=t.getAttribute("wu-click"),n=t.getAttribute("wu-data");y[r]&&y[r](e,n);break}t=t.parentNode}});const $={wx:p,wijax:E,jsonize:B,loadScript:A,registerComponent:I,buildComponent:h,buildComponents:J,components:i,registerProfile:H,registerAction:g,registerEventHandler:ne,navigateTo:X,getRouteParams:Y,registerData:U,addData:q,findIndexByKey:M,updateData:_,removeData:z,dataStore:c,onLoad:ee,init:j};return typeof window<"u"&&(window.wu=$),$})();
